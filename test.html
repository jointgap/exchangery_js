<!DOCTYPE html> 
<html> 
	<head> 
		<meta charset="UTF-8"> 
		<style type="text/css"> 
			* {
				margin: 0;
				padding: 0;
			}
			body {
				padding: 25px;
			}
			table {
				border-collapse: collapse;
			}
			table td {
				padding: 5px 10px;
				border: 1px solid black;
			}
			#orders-grid {
				width: 800px;
			}
			#orders-grid td {
				width: 20%;
			}
			#orders-grid td:first-child {
				cursor: pointer;
			}
			.orders-grid-detail {
				width: 800px;
				background: white;
			}
			.orders-grid-detail td {
				width: 20%;
			}
		</style> 
		<script src="js/jquery.js" type="text/javascript"></script> 
		<script src="js/exchng.js" type="text/javascript"></script> 
		<title>Exchange Test</title> 
	</head> 
	<body> 
		<h1>Products</h1>
		<table id="products"> 
			<thead> 
				<tr> 
					<td width="20%">product</td> 
					<td width="20%">bid quantity</td> 
					<td width="20%">bid</td> 
					<td width="20%">offer</td> 
					<td width="20%">offer quantity</td> 
				</tr> 
			</thead> 
			<tbody> 
			</tbody> 
		</table> 
		<br>
		<h1>Order</h1>
		<form id="order">
		  symbol: <select type="text" id="symbol" name="symbol"></select>
		  side: <select id="side" name="side">
		    <option value="buy">buy</option>
		    <option value="sell">sell</option>
		  </select>
		  quantity: <input type="number" id="quantity" name="quantity" min="1"/>
		  price: <input type="number" id="price" name="price" min="0"/>
		  <input type="submit" value="Place Order"/>
		</form>
		<script type="text/javascript">
			(function() {
				var exchng = new Exchng(123, function(event) {
					switch(event['name']) {
						case 'fetch-complete':
							$('#order [name=symbol] option').addClass('marked');
							$.each(exchng.products, function() {
								if($('#order [name=symbol] option:contains(' + this['symbol'] + ')').removeClass('marked').length == 0) {
									$('#order [name=symbol]').append($('<option></option>').text(this['symbol']));
								}
							});
							$('#order [name=symbol] option.marked').detach();
							$('#products tbody').empty();
							$.each(exchng.products, function() {
								var product = this;
								$.each(this['details'], function() {
									var detail = this;
									var tr = $('<tr></tr>');
									if(!detail['best']) {
										tr.css('display', 'none');
									}
									tr.append($('<td></td>').text(product['symbol']));
									$.each(['bid_quantity', 'bid', 'offer', 'offer_quantity'], function() {
										if(detail[this]) {
											tr.append($('<td></td>').text(detail[this]));
										} else {
											tr.append($('<td></td>'));
										}
									});
									$('#products tbody').append(tr);
								});
							});
							break;
					}
				});
				$('form').submit(function() {
					requestData = {
						order: {
							market: exchng.marketId,
							symbol: $('[name=symbol]').val(),
							side: $('[name=side]').val(),
							quantity: $('[name=quantity]').val(),
							price: $('[name=price]').val(),
						}
					}
					$.ajax({
						type: 'POST',
						url: 'ts/orders', 
						contentType: 'application/json; charset=utf-8', 
						dataType: 'json',
						processData : false,
						data: JSON.stringify(requestData),
						success: function(data) {
							console.log(data);
						}
					});
					return false;
				});
				exchng.fetchData();
				exchng.beginPoll();
			})();
		</script> 
	</body> 
</html> 


